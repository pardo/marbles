parcelRequire=function(e,r,n,t){var i="function"==typeof parcelRequire&&parcelRequire,o="function"==typeof require&&require;function u(n,t){if(!r[n]){if(!e[n]){var f="function"==typeof parcelRequire&&parcelRequire;if(!t&&f)return f(n,!0);if(i)return i(n,!0);if(o&&"string"==typeof n)return o(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[n][1][r]||r};var l=r[n]=new u.Module(n);e[n][0].call(l.exports,p,l,l.exports,this)}return r[n].exports;function p(e){return u(p.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=r,u.parent=i,u.register=function(r,n){e[r]=[function(e,r){r.exports=n},{}]};for(var f=0;f<n.length;f++)u(n[f]);if(n.length){var c=u(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=c:"function"==typeof define&&define.amd?define(function(){return c}):t&&(this[t]=c)}return u}({"2iMt":[function(require,module,exports) {

},{}],"Focm":[function(require,module,exports) {
"use strict";function t(t){var e,s,i,n=t.length;if(0===n)return!1;for(;--n;)e=Math.floor(Math.random()*(n+1)),s=t[n],i=t[e],t[n]=i,t[e]=s;return t}function e(t,e,s){var i,n;return function(){var o=this,r=arguments,a=s&&!i;return clearTimeout(i),i=setTimeout(function(){i=null,s||(n=t.apply(o,r))},e),a&&(n=t.apply(o,r)),n}}function s(t,s){var i,n,o,r,a,l,h=e(function(){a=r=!1},s);return function(){i=this,n=arguments;return o||(o=setTimeout(function(){o=null,a&&t.apply(i,n),h()},s)),r?a=!0:l=t.apply(i,n),h(),r=!0,l}}function i(){this.timeouts={},this.flags={},this.getFlag=function(t){return this.flags[t]},this.addTemporalFlag=function(t,e,s){var i=this;window.clearTimeout(this.timeouts[t]),this.flags[t]=new Date,this.timeouts[t]=setTimeout(function(){var e=(new Date).getTime()-i.flags[t];i.flags[t]=!1,s(e)},e)},this.removeTemporalFlag=function(t){window.clearTimeout(this.timeouts[t]),this.flags[t]=!1},this.addTemporalProperty=function(t,e,s){var i=this;s=void 0===s?function(){}:s,this["is"+t]=function(){return i.getFlag(t)},this["set"+t]=function(n){return n=void 0!==n?n:e,i.addTemporalFlag(t,n,s)},this["unset"+t]=function(){i.removeTemporalFlag(t)}}}function n(t){this.setMarbleMultiplier=function(t){this.marbleMultiplierType=void 0===t?["d","r","g","o","b"][Math.floor(5*Math.random())]:t,this.marbleMultiplier=1,console.log("Multiplier: "+this.marbleMultiplierType)},this.trackRemoved=function(t,e){var s=(new Date).getTime()-this.lastRemoveAt;if(this.lastRemoveAt=(new Date).getTime(),this.points.push([t,e,this.lastRemoveAt,s]),e===this.marbleMultiplierType&&(this.marbleMultiplier+=1),s>200?this.combo=0:this.combo+=1,5===t)return this.sendMarblesLoop(),void this.setMarbleMultiplier(e);var i=e===this.marbleMultiplierType,n=1;return 3===t?n=i?3:1:4===t&&(n=i?4:2),this.sendMarbles(n+2*this.combo)},this.sendMarblesLoop=function(){var t=this;console.log("Do Loop: "+this.marbleMultiplier);for(var e=1;e<=this.marbleMultiplier;e++)setTimeout(function(){t.sendMarbles(3)},1e3*e)},this.sendMarbles=function(t){console.log("Sending: "+t),this.sendMarblesCallback(t)},this.setMarbleMultiplier(),this.combo=0,this.lastRemoveAt=(new Date).getTime(),this.points=[],this.sendMarblesCallback=t}function o(t){var e=this;this.type=t,this.isEmpty="x"===t,this.isNew=!0,this.addedFromTop=!1,setTimeout(function(){e.isNew=!1},550),this.tf=new i,this.tf.addTemporalProperty("TranslatingRight",90),this.tf.addTemporalProperty("MovingDown",110),this.tf.addTemporalProperty("MovingUp",110)}function r(){var e=this;this.initialize=function(t,e){var s=this;this.container=t,this.scoreContainer=e,this.pointsTracker=new n(function(t){s.sendMarbles(t)}),this.temporalFlags=new i,this.temporalFlags.addTemporalProperty("Locked",130,function(t){s.resetAnimations()}),this.columnSize=15,this.center=Math.floor(7.5),this.cursor=2,this.columns=[this.getEmptyColumn(this.columnSize),this.getEmptyColumn(this.columnSize),this.getEmptyColumn(this.columnSize),this.getEmptyColumn(this.columnSize),this.getEmptyColumn(this.columnSize)],this.fillColumns(),this.createDom()},this.sendMarbles=function(t){this.otherGame.receiveMarbles(t)},this.receiveMarbles=function(t){this.attachReceiveMarble(t),this.addRandomMarbles(t)},this.setOtherPlayerGame=function(t){this.otherGame=t},this.getEmptyColumn=function(t){for(var e=[],s=0;s<t;s++)e.push(new o("x"));return e},this.getTopSectionOfColumn=function(t,e){return e?this.columns[t].slice(this.center):this.columns[t].slice(this.center+1)},this.getBottomSectionOfcolumn=function(t,e){return e?this.columns[t].slice(0,this.center+1):this.columns[t].slice(0,this.center)},this.getNumberOfMarblesInTopSection=function(t){return this.center-this.getTopSectionOfColumn(t).filter(function(t){return t.isEmpty}).length},this.getNumberOfMarblesInBottomSection=function(t){return this.center-this.getBottomSectionOfcolumn(t).filter(function(t){return t.isEmpty}).length},this.getNumberOfMarblesInColumn=function(t){return this.columnSize-this.columns[t].filter(function(t){return t.isEmpty}).length},this.fillColumn=function(t){this.temporalFlags.setLocked();var e=this.getNumberOfMarblesInColumn(t);if(!(e>=5)){var s=5-e;this.getNumberOfMarblesInTopSection(t)<this.getNumberOfMarblesInBottomSection(t)?this.addRandomMarbles(1,t,!0):this.addRandomMarbles(1,t,!1),s>1&&this.fillColumn(t)}},this.fillColumns=function(){for(var t=0;t<5;t++)this.fillColumn(t)},this.addRandomMarbles=function(e,s,i){var n;if(void 0===s)for(var o=t([0,1,2,3,4,0,1,2,3,4,0,1,2,3,4]);e>0&&o.length>0;){n=o.pop();var r=void 0===i?Math.random()>.5:i,a=!1;!(a=r?this.addMarbleFromTop(this.getRandomMarble(),n):this.addMarbleFromBottom(this.getRandomMarble(),n))&&r?a=this.addMarbleFromBottom(this.getRandomMarble(),n):!a&&r&&(a=this.addMarbleFromTop(this.getRandomMarble(),n)),a&&(e-=1)}else for(var l=0;l<e;l++){(void 0===i?Math.random()>.5:i)?this.addMarbleFromTop(this.getRandomMarble(),s):this.addMarbleFromBottom(this.getRandomMarble(),s)}},this.getRandomMarbles=function(t){for(var e=[],s=0;s<t;s++)e.push(this.getRandomMarble());return e},this.getRandomMarble=function(){return new o(["d","r","g","o","b"][Math.floor(5*Math.random())])},this.checkForEquals=function(t,e){for(var s=e;s<t+e-1;s++)if(this.columns[s][this.center].type!==this.columns[s+1][this.center].type)return!1;return!0},this.removeMarbles=function(t,e){this.pointsTracker.trackRemoved(t,this.columns[e][this.center].type),this.temporalFlags.setLocked();for(var s=e;s<t+e;s++){var i=this.columns[s];i.splice(this.center,1),i.push(new o("x")),i[this.center].isEmpty?(i.unshift(new o("x")),i.pop(),this.getBottomSectionOfcolumn(s,!0).forEach(function(t){t.tf.setMovingUp()})):this.getTopSectionOfColumn(s,!0).forEach(function(t){t.tf.setMovingDown()})}return this.fillColumns(),!0},this.translateCenterRight=function(){if(!this.temporalFlags.isLocked()){this.temporalFlags.setLocked();for(var t=this.columns[4][this.center],e=4;e>0;e--)this.columns[e][this.center]=this.columns[e-1][this.center],this.columns[e][this.center].tf.setTranslatingRight();this.columns[0][this.center]=t,this.columns[0][this.center].tf.setTranslatingRight(),this.checkCenterMarbles()}},this._checkAndRemove=function(){return this.checkForEquals(5,0)?this.removeMarbles(5,0):this.checkForEquals(4,0)?this.removeMarbles(4,0):this.checkForEquals(4,1)?this.removeMarbles(4,1):this.checkForEquals(3,0)?this.removeMarbles(3,0):this.checkForEquals(3,1)?this.removeMarbles(3,1):!!this.checkForEquals(3,2)&&this.removeMarbles(3,2)},this.checkCenterMarbles=function(){var t=this;this.temporalFlags.isLocked()?setTimeout(function(){t.checkCenterMarbles()},140):this._checkAndRemove()&&(this.temporalFlags.setLocked(),setTimeout(function(){t.checkCenterMarbles()},140))},this.addMarbleFromTop=function(t,e){this.temporalFlags.setLocked(),t.tf.setMovingDown();for(var s=!1,i=this.columns[e],n=this.center;n<i.length;n++)i[n].isEmpty&&!s&&(s=!0,i[n]=t),s&&i[n].tf.setMovingDown();return s},this.addMarbleFromBottom=function(t,e){this.temporalFlags.setLocked(),t.tf.setMovingUp();for(var s=!1,i=this.columns[e],n=this.center;n>=0;n--)i[n].isEmpty&&!s&&(s=!0,i[n]=t),s&&i[n].tf.setMovingUp();return s},this.doGravity=function(t){this.columns[t][this.center].isEmpty&&this.removeMarbles(1,t)},this.swapCenterMarbles=function(t,e){var s=this.columns[t][this.center],i=this.columns[e][this.center];s.isEmpty&&i.isEmpty||(this.columns[t][this.center]=i,this.columns[e][this.center]=s,this.doGravity(t),this.doGravity(e))},this.left=function(t){var e=this.cursor;this.cursor-=1,this.cursor=Math.max(this.cursor,0),t&&this.swapCenterMarbles(e,this.cursor),this.checkCenterMarbles()},this.right=function(t){var e=this.cursor;this.cursor+=1,this.cursor=Math.min(this.cursor,4),t&&this.swapCenterMarbles(e,this.cursor),this.checkCenterMarbles()},this.down=function(){if(!this.temporalFlags.isLocked())if(this.columns[this.cursor][0].isEmpty)if(this.columns[this.cursor][this.center+1].isEmpty)console.log("No marble to move into the center");else{var t=this.columns[this.cursor],e=new o("x");t.push(e),t.shift(),t.forEach(function(t){t.tf.setMovingDown()}),this.temporalFlags.setLocked(),this.checkCenterMarbles()}else console.log("Doesn't have space at bottom")},this.up=function(){if(!this.temporalFlags.isLocked())if(this.columns[this.cursor][this.columnSize-1].isEmpty)if(this.columns[this.cursor][this.center-1].isEmpty)console.log("No marble to move into the center");else{var t=this.columns[this.cursor];t.unshift(new o("x")),t.pop(),t.forEach(function(t){t.tf.setMovingUp()}),this.temporalFlags.setLocked(),this.checkCenterMarbles()}else console.log("Doesn't have space at top")},this.resetAnimations=function(){this.columnsDom.forEach(function(t){t.forEach(function(t){t.classList.remove("translate-right"),t.classList.remove("moving-up"),t.classList.remove("moving-down"),t.offsetWidth})}),this.draw()},this.setMarbleClasses=function(t,e){e.classList.contains(t.type)||(["x","d","r","g","o","b"].forEach(function(t){e.classList.remove(t)}),e.classList.add(t.type)),t.tf.isTranslatingRight()?(e.classList.add("translate-right"),e.classList.remove("moving-down"),e.classList.remove("moving-up")):t.tf.isMovingDown()?(e.classList.add("moving-down"),e.classList.remove("translate-right"),e.classList.remove("moving-up")):t.tf.isMovingUp()?(e.classList.add("moving-up"),e.classList.remove("translate-right"),e.classList.remove("moving-down")):(e.classList.remove("moving-up"),e.classList.remove("moving-down"),e.classList.remove("translate-right"))},this.drawMarble=function(t,e,s){var i=this.columnsDom[e][s];this.setMarbleClasses(t,i),s===this.center&&(e===this.cursor?this.cursorDom[e].classList.add("cursor"):this.cursorDom[e].classList.remove("cursor"))},this.draw=function(){var t=this;this.columns.forEach(function(e,s){e.forEach(function(e,i){t.drawMarble(e,s,i)})}),this.setMarbleClasses(new o(this.pointsTracker.marbleMultiplierType),this.marbleMultiplierDom),this.marbleMultiplierDom.innerText=this.pointsTracker.marbleMultiplier},this.throttledDraw=s(function(){e.draw()},10),this.createRowElement=function(t,e){var s=document.createElement("div");return s.className=e?"row center":"row",t.appendChild(s),s},this.createMarbleElement=function(t){var e=document.createElement("div");return e.className="marble",t&&t.appendChild(e),e},this.bindAnimationLock=function(t,e,s){var i=this;t.addEventListener("animationstart",function(t){"moving-down"!==t.animationName&&"moving-up"!==t.animationName&&"translate-right"!==t.animationName||i.temporalFlags.setLocked()})},this.attachReceiveMarble=function(t){var e=document.createElement("div");e.innerText=t+"x",e.addEventListener("animationend",function(t){e.remove()}),this.receiveDom.prepend(e)},this.createDom=function(){this.receiveDom=this.scoreContainer.getElementsByClassName("receive")[0],this.marbleMultiplierDom=this.scoreContainer.getElementsByClassName("marble")[0],this.cursorDom=[],this.columnsDom=[Array(this.columnSize),Array(this.columnSize),Array(this.columnSize),Array(this.columnSize),Array(this.columnSize)];for(var t=this.columnSize-1;t>=0;t--){for(var e,s=this.createRowElement(this.container),i=0;i<5;i++)e=this.createMarbleElement(s),this.columnsDom[i][t]=e,this.bindAnimationLock(e,i,t);if(t===this.center){s=this.createRowElement(this.container,!0);for(var n=0;n<5;n++)this.cursorDom[n]=this.createMarbleElement(s)}}}}Object.defineProperty(exports,"__esModule",{value:!0}),require("./style.css");var a=new r,l=new r;a.setOtherPlayerGame(l),l.setOtherPlayerGame(a),window.addEventListener("keydown",function(t){switch(t.which){case 37:l.left();break;case 38:l.up();break;case 39:l.right();break;case 40:l.down();break;case 76:l.translateCenterRight();break;case 83:a.left();break;case 69:a.up();break;case 70:a.right();break;case 68:a.down();break;case 81:a.translateCenterRight();break;default:console.log(t.which)}}),window.addEventListener("load",function(){a.initialize(document.getElementById("p1"),document.getElementById("p1-score")),l.initialize(document.getElementById("p2"),document.getElementById("p2-score")),setInterval(function(){a.checkCenterMarbles(),l.checkCenterMarbles(),a.draw(),l.draw()},20)}),console.log('\nThe keys are for the player on the left\nUp and Down with "e" "d"\nMove Cursor Left and right with "s" "f"\nRotate Center with "q"\n\nThe keys are for the player on the right\nArrow Keys for movement\nRotate Center with "l"\n\n'),exports.default=a;
},{"./style.css":"2iMt"}]},{},["Focm"], null)
//# sourceMappingURL=https://pardo.github.io/marbles/marbles.80a2fc0d.map